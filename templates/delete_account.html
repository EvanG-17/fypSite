{% extends "base.html" %}

{% block content %}
<div class="login-container">
    <h2 class="login-title">Delete Account</h2>
    <p style="margin-bottom: 20px;">
        Are you sure you want to delete your account? This action cannot be undone.
    </p>

    <div>
        <input type="email" id="reAuthEmail" placeholder="Re-enter your email" class="login-input" required>
        <input type="password" id="reAuthPassword" placeholder="Re-enter your password" class="login-input" required>
    </div>

    <button onclick="handleAccountDeletion()" class="delete-btn">Yes, Delete My Account</button>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import {
        getAuth,
        signInWithEmailAndPassword,
        deleteUser
    } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBoUCKaswlxAlXTyO_5LCDjl10lEXqKmNg",
        authDomain: "evanfypworking.firebaseapp.com",
        projectId: "evanfypworking",
        storageBucket: "evanfypworking.appspot.com",
        messagingSenderId: "413702763958",
        appId: "1:413702763958:web:e4411b617ab80442f3bd17",
        measurementId: "G-SLN4E8LJYN"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    window.handleAccountDeletion = async function () {
        const email = document.getElementById("reAuthEmail").value.trim();
        const password = document.getElementById("reAuthPassword").value.trim();

        if (!email || !password) {
            alert("Please enter your email and password to confirm.");
            return;
        }

        try {
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;

            await deleteUser(user);
            // alert("Your account has been successfully deleted.");
            window.location.href = "{{ url_for('logout') }}";
        } catch (error) {
            alert("Error: " + error.message);
        }
    };
</script>
{% endblock %}
